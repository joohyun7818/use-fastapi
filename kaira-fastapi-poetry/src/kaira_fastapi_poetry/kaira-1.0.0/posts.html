<!DOCTYPE html>
<html lang="en">

<head>
  <title>Post Console - Kaira</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="css/vendor.css">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
  <nav class="navbar navbar-expand-lg bg-light border-bottom py-3">
    <div class="container">
      <a class="navbar-brand" href="index.html"><img src="images/main-logo.png" alt="logo"></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="auth.html">Auth</a></li>
          <li class="nav-item"><a class="nav-link" href="users.html">Users</a></li>
          <li class="nav-item"><a class="nav-link active" href="posts.html">Posts</a></li>
          <li class="nav-item"><a class="nav-link" href="system.html">System</a></li>
          <li class="nav-item"><a class="nav-link" href="tester.html">Tester</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="py-5">
    <section class="container">
      <div class="row g-4 align-items-start">
        <div class="col-lg-4">
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body">
              <p class="text-uppercase text-muted mb-2">환경</p>
              <label class="form-label" for="base-url">Base URL</label>
              <input id="base-url" class="form-control">
              <p class="small text-muted mt-2">콘솔 전역에서 공유되는 API 주소입니다.</p>
            </div>
          </div>
          <div class="card border-0 shadow-sm">
            <div class="card-body">
              <p class="text-uppercase text-muted mb-2">작성 권한</p>
              <div id="post-session-state">
                <span class="badge bg-secondary">로그인 필요</span>
                <p class="small text-muted mb-0">게시물 생성/수정/삭제는 인증된 사용자만 가능합니다.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-8">
          <div class="row g-4">
            <div class="col-md-6">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <h5>게시물 목록</h5>
                  <span class="badge bg-secondary">GET /api/posts/</span>
                  <form id="posts-form" data-result-target="posts-result" class="mt-3">
                    <div class="row g-3">
                      <div class="col-6">
                        <label class="form-label">Skip</label>
                        <input name="skip" type="number" class="form-control" value="0" min="0">
                      </div>
                      <div class="col-6">
                        <label class="form-label">Limit</label>
                        <input name="limit" type="number" class="form-control" value="10" min="1">
                      </div>
                    </div>
                    <button class="btn btn-dark w-100 mt-3" type="submit">목록 조회</button>
                  </form>
                  <pre id="posts-result" class="bg-light p-3 rounded mt-3"></pre>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                  <h5>발행글 피드</h5>
                  <span class="badge bg-secondary">GET /api/posts/published</span>
                  <form id="published-form" data-result-target="published-result" class="mt-3">
                    <div class="row g-3">
                      <div class="col-6">
                        <label class="form-label">Skip</label>
                        <input name="skip" type="number" class="form-control" value="0" min="0">
                      </div>
                      <div class="col-6">
                        <label class="form-label">Limit</label>
                        <input name="limit" type="number" class="form-control" value="10" min="1">
                      </div>
                    </div>
                    <button class="btn btn-outline-dark w-100 mt-3" type="submit">발행글 조회</button>
                  </form>
                  <pre id="published-result" class="bg-light p-3 rounded mt-3"></pre>
                </div>
              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm mt-4">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">게시물 읽기</h5>
                <span class="badge bg-secondary">GET /api/posts/{id}</span>
              </div>
              <form id="get-post-form" data-result-target="get-post-result" class="mt-3">
                <div class="row g-3 align-items-end">
                  <div class="col-md-4">
                    <label class="form-label">Post ID</label>
                    <input name="post_id" type="number" class="form-control" min="1" required>
                  </div>
                  <div class="col-md-4 ms-auto">
                    <button class="btn btn-dark w-100" type="submit">조회</button>
                  </div>
                </div>
              </form>
              <pre id="get-post-result" class="bg-light p-3 rounded mt-3"></pre>
            </div>
          </div>

          <div class="card border-0 shadow-sm mt-4">
            <div class="card-body">
              <div class="row g-4">
                <div class="col-md-6 border-end">
                  <h5>게시물 작성</h5>
                  <span class="badge bg-secondary">POST /api/posts/?author_id=</span>
                  <form id="create-post-form" data-result-target="create-post-result" data-require-auth="true" class="mt-3">
                    <label class="form-label">Author ID</label>
                    <input name="author_id" type="number" class="form-control" min="1" required>
                    <label class="form-label mt-3">Title</label>
                    <input name="title" class="form-control" required>
                    <label class="form-label mt-3">Content</label>
                    <textarea name="content" class="form-control" rows="4" required></textarea>
                    <button class="btn btn-dark w-100 mt-3" type="submit">작성</button>
                  </form>
                  <pre id="create-post-result" class="bg-light p-3 rounded mt-3"></pre>
                </div>
                <div class="col-md-6">
                  <h5>게시물 수정</h5>
                  <span class="badge bg-secondary">PUT /api/posts/{id}</span>
                  <form id="update-post-form" data-result-target="update-post-result" data-require-auth="true" class="mt-3">
                    <label class="form-label">Post ID</label>
                    <input name="post_id" type="number" class="form-control" min="1" required>
                    <label class="form-label mt-3">Title</label>
                    <input name="title" class="form-control">
                    <label class="form-label mt-3">Content</label>
                    <textarea name="content" class="form-control" rows="3"></textarea>
                    <label class="form-label mt-3">Publish 상태</label>
                    <select name="is_published" class="form-select">
                      <option value="">변경 없음</option>
                      <option value="true">Published</option>
                      <option value="false">Draft</option>
                    </select>
                    <button class="btn btn-outline-dark w-100 mt-3" type="submit">업데이트</button>
                  </form>
                  <pre id="update-post-result" class="bg-light p-3 rounded mt-3"></pre>
                </div>
              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm mt-4">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">게시물 삭제</h5>
                <span class="badge bg-secondary">DELETE /api/posts/{id}</span>
              </div>
              <form id="delete-post-form" data-result-target="delete-post-result" data-require-auth="true" class="mt-3">
                <div class="row g-3 align-items-end">
                  <div class="col-md-4">
                    <label class="form-label">Post ID</label>
                    <input name="post_id" type="number" class="form-control" min="1" required>
                  </div>
                  <div class="col-md-4 ms-auto">
                    <button class="btn btn-danger w-100" type="submit">삭제</button>
                  </div>
                </div>
              </form>
              <pre id="delete-post-result" class="bg-light p-3 rounded mt-3"></pre>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="border-top py-4 mt-5">
    <div class="container text-center text-md-start">
      <p class="mb-0">&copy; 2024 Kaira API Portal.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  <script src="js/api-pages.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      apiHelpers.bindBaseInputs('#base-url');

      const sessionState = document.getElementById('post-session-state');
      apiHelpers.onAuthChange(({ accessToken }) => {
        if (accessToken) {
          sessionState.innerHTML = '<span class="badge bg-success">작성 가능</span><p class="small text-muted mb-0">토큰이 적용되어 쓰기 작업이 허용됩니다.</p>';
        } else {
          sessionState.innerHTML = '<span class="badge bg-secondary">로그인 필요</span><p class="small text-muted mb-0">작성/수정/삭제는 인증 후 가능</p>';
        }
      });

      apiHelpers.attachForm('posts-form', (form) => {
        const skip = Number(form.skip.value) || 0;
        const limit = Number(form.limit.value) || 10;
        return apiHelpers.callApi({ method: 'GET', path: '/api/posts/', query: { skip, limit } });
      });

      apiHelpers.attachForm('published-form', (form) => {
        const skip = Number(form.skip.value) || 0;
        const limit = Number(form.limit.value) || 10;
        return apiHelpers.callApi({ method: 'GET', path: '/api/posts/published', query: { skip, limit } });
      });

      apiHelpers.attachForm('get-post-form', (form) => {
        const postId = Number(form.post_id.value);
        return apiHelpers.callApi({ method: 'GET', path: `/api/posts/${postId}` });
      });

      apiHelpers.attachForm('create-post-form', (form) => {
        const authorId = Number(form.author_id.value);
        const payload = {
          title: form.title.value.trim(),
          content: form.content.value.trim(),
        };
        return apiHelpers.callApi({ method: 'POST', path: '/api/posts/', query: { author_id: authorId }, body: payload });
      }, { requireAuth: true });

      apiHelpers.attachForm('update-post-form', (form) => {
        const postId = Number(form.post_id.value);
        const payload = {};
        if (form.title.value.trim()) payload.title = form.title.value.trim();
        if (form.content.value.trim()) payload.content = form.content.value.trim();
        if (form.is_published.value === 'true') payload.is_published = true;
        if (form.is_published.value === 'false') payload.is_published = false;
        return apiHelpers.callApi({ method: 'PUT', path: `/api/posts/${postId}`, body: payload });
      }, { requireAuth: true });

      apiHelpers.attachForm('delete-post-form', (form) => {
        const postId = Number(form.post_id.value);
        return apiHelpers.callApi({ method: 'DELETE', path: `/api/posts/${postId}` });
      }, { requireAuth: true });
    });
  </script>
</body>

</html>
